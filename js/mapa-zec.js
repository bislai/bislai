var width=window.innerWidth>0?window.innerWidth:screen.width;$(function(){d3.json("mapas/distritos-zec-zaragoza.geojson",function(t,e){!function(t){mapboxgl.accessToken="pk.eyJ1Ijoiam9yZ2VhdGd1IiwiYSI6ImNqdm5vOXB1NzFreXczem1nanptb3Q3bTUifQ.ffla2sla83t7DMKiwyLIMQ";var e=new mapboxgl.Map({container:"map",style:"mapbox://styles/jorgeatgu/cjf4fr0sj019m2qqiaz1mynna",center:[-.850431,41.651729],zoom:11.5});e.addControl(new mapboxgl.Navigation);var a=e.getCanvasContainer(),n=d3.select(a).append("svg"),s=(n.append("g").attr("class","distritos"),d3.geoTransform({point:function(t,a){var n=e.project(new mapboxgl.LngLat(t,a));this.stream.point(n.x,n.y)}})),r=d3.geoPath().projection(s),o=d3.select("#map").append("div").attr("class","tooltip tooltip-zec"),i=n.selectAll("path").data(t.features).enter().append("path").attr("class","distritosZEC").on("mouseover",function(t){o.style("display","block").html('<h4 class="tooltipTitulo">'+t.properties.distrito+'</h4><div class="container-tooltip-partido"><p class="tooltipPartido"><span class="resultado-izda"><span class="titulo-partido">2015</span><span style="width:'+1.65*t.properties.quince_p+'%" class="bgc-zec"></span></span><span class="resultado"><span class="resultadoVotos"> '+t.properties.quince_p+'%</span><span class="resultadoVotos">'+t.properties.quince_v+" votos</span><p/>").transition().duration(200)}).transition().duration(200);e.scrollZoom.disable(),i.attr("d",r)}(e)})});const csvElements=["datos/zec/en-su-contra.csv","datos/zec/a-su-favor.csv","datos/zec/abstencion.csv","datos/zec/en-contra.csv","datos/zec/a-favor.csv"];function estadisticasChart(t){const e={top:24,right:24,bottom:24,left:24};let a=0,n=0,s=0,r=0;const o=d3.select(".chart-estadisticas"),i=o.select("svg"),c={};let l;function d(t){s=o.node().offsetWidth,r=400,a=s-e.left-e.right,n=r-e.top-e.bottom,i.attr("width",s).attr("height",r);const l="translate("+e.left+","+e.top+")",d=i.select(".chart-estadisticas-container");d.attr("transform",l),function(t,e){c.count.x.range([0,t]).padding(.6),c.count.y.range([e,0])}(a,n);const p=o.select(".area-container-chart-vertical").selectAll(".bar-vertical").data(t),u=p.enter().append("rect").attr("class","bar-vertical");p.merge(u).attr("width",c.count.x.bandwidth()).attr("x",t=>c.count.x(t.nombre)).attr("y",t=>c.count.y(0)).attr("height",0).transition().ease(d3.easeSin).duration(1200).attr("y",t=>c.count.y(t.valor)).attr("height",t=>n-c.count.y(t.valor)),function(t){const e=d3.axisBottom(c.count.x);t.select(".axis-x").attr("transform","translate(0,"+n+")").call(e);const a=d3.axisLeft(c.count.y).tickFormat(d3.format("d")).ticks(5).tickSizeInner(-s);t.select(".axis-y").transition().duration(1e3).call(a)}(d)}window.addEventListener("resize",function(){d(l)}),d3.csv(t,function(t,e){t?console.log(t):((l=e).forEach(t=>{t.valor=+t.valor}),function(){const t=i.select(".chart-estadisticas-container");t.append("g").attr("class","axis axis-x"),t.append("g").attr("class","axis axis-y"),t.append("g").attr("class","area-container-chart-vertical")}(),function(){const t=d3.scaleBand().domain(l.map(function(t){return t.nombre})),e=d3.scaleLinear().domain([0,d3.max(l,t=>t.valor)+d3.max(l,t=>t.valor)/4]);c.count={x:t,y:e}}(),d(l))})}var container=document.getElementById("scroll"),step=document.querySelector(".step"),graphic=document.querySelector(".scroll__graphic"),text=document.querySelector(".scroll__text"),scroller=scrollama();function handleResize(){var t=Math.floor(.75*window.innerHeight);step.style.height=t+"px";var e=step.getBoundingClientRect(),a=container.getBoundingClientRect().width,n=(e.width,a.width,a-64),s=Math.floor(window.innerHeight/2);Math.floor(s/2);graphic.style.width=n,graphic.style.height=s,scroller.resize()}function handleStepEnter(t){0===t.index?estadisticasChart(csvElements[0]):1===t.index?estadisticasChart(csvElements[1]):2===t.index?estadisticasChart(csvElements[2]):3===t.index?estadisticasChart(csvElements[3]):4===t.index&&estadisticasChart(csvElements[4])}function init(){handleResize(),scroller.setup({container:"#scroll",graphic:".scroll__graphic",text:".scroll__text",step:".scroll__text .step",offset:.63}).onStepEnter(handleStepEnter),window.addEventListener("resize",handleResize)}function initResponsive(){scroller.setup({step:".step"}).onStepEnter(handleStepEnter)}function multipleLines(){var t=24,e=24,a=24,n=24,s=960-n-e,r=220-t-a;d3.scaleOrdinal(["#9a1622","#e30613","#0080b8","#f07a36"]);let o=d3.timeParse("%x");var i=d3.scaleTime().range([0,s]),c=d3.scaleLinear().range([r,0]),l=d3.area().x(function(t){return i(t.fecha)}).y0(r).y1(function(t){return c(t.votos)}).curve(d3.curveBasis),d=d3.line().x(function(t){return i(t.fecha)}).y(function(t){return c(t.votos)}).curve(d3.curveBasis);d3.csv("datos/zec/legislatura-zec-votos-a-favor.csv",function(t){return t.votos=+t.votos,t.fecha=o(t.fecha),t},function(o,p){var u=d3.nest().key(function(t){return t.presentada}).entries(p);u.forEach(function(t){t.maxPrice=d3.max(t.values,function(t){return t.votos})}),i.domain([d3.min(p,t=>t.fecha),d3.max(p,t=>t.fecha)]),c.domain([d3.min(p,t=>t.votos),d3.max(p,t=>t.votos)]);var h=d3.select(".grafica-favor-legislatura").selectAll("svg").data(u).enter().append("svg").attr("viewBox","0 0 "+(s+(n+e))+"  "+(r+(t+a))).append("g").attr("transform","translate("+n+","+t+")");h.append("g").attr("class","axis axis-x"),h.append("g").attr("class","axis axis-y");var v=d3.axisBottom(i).tickFormat(d3.timeFormat("%Y")).ticks(5),f=d3.axisLeft(c).tickFormat(d3.format("d")).ticks(5).tickSizeInner(-s);h.select(".axis-x").attr("transform","translate(0,"+r+")").call(v),h.select(".axis-y").call(f),h.append("path").attr("class","area").attr("class",function(t){return t.key}).style("opacity",.7).attr("d",function(t){return l(t.values)}),h.append("path").attr("class","line").attr("d",function(t){return d(t.values)}).style("stroke","#111"),h.append("text").attr("class","multiple-legend").attr("x",16).attr("y",-10).style("text-anchor","start").text(function(t){return t.key})})}width>769?init():initResponsive(),multipleLines();