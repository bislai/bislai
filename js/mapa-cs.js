var width=window.innerWidth>0?window.innerWidth:screen.width;$(function(){d3.json("mapas/distritos-ciudadanos-zaragoza.geojson",function(t,a){!function(t){mapboxgl.accessToken="pk.eyJ1Ijoiam9yZ2VhdGd1IiwiYSI6ImNqdm5vOXB1NzFreXczem1nanptb3Q3bTUifQ.ffla2sla83t7DMKiwyLIMQ";var a=new mapboxgl.Map({container:"map",style:"mapbox://styles/jorgeatgu/cjf4g011p1a8w2rsvlz258uqr",center:[-.850431,41.651729],zoom:11.5});a.addControl(new mapboxgl.Navigation);var e=a.getCanvasContainer(),s=d3.select(e).append("svg"),n=(s.append("g").attr("class","distritos"),d3.geoTransform({point:function(t,e){var s=a.project(new mapboxgl.LngLat(t,e));this.stream.point(s.x,s.y)}})),o=d3.geoPath().projection(n),r=d3.select("#map").append("div").attr("class","tooltip tooltip-cs"),i=s.selectAll("path").data(t.features).enter().append("path").attr("class","distritosCS").on("mouseover",function(t){r.style("display","block").html('<h4 class="tooltipTitulo">'+t.properties.distrito+'</h4><div class="container-tooltip-partido"><p class="tooltipPartido"><span class="resultado-izda"><span class="titulo-partido">2015</span><span style="width:'+1.65*t.properties.quince_p+'%" class="bgc-cs"></span></span><span class="resultado"><span class="resultadoVotos"> '+t.properties.quince_p+'%</span><span class="resultadoVotos">'+t.properties.quince_v+" votos</span><p/>").transition().duration(200)}).transition().duration(200);a.scrollZoom.disable(),i.attr("d",o)}(a)})});const csvElements=["datos/ciudadanos/en-su-contra.csv","datos/ciudadanos/a-su-favor.csv","datos/ciudadanos/abstencion.csv","datos/ciudadanos/en-contra.csv","datos/ciudadanos/a-favor.csv"];function estadisticasChart(t){const a={top:24,right:24,bottom:24,left:24};let e=0,s=0,n=0,o=0;const r=d3.select(".chart-estadisticas"),i=r.select("svg"),c={};let l;function d(t){n=r.node().offsetWidth,o=400,e=n-a.left-a.right,s=o-a.top-a.bottom,i.attr("width",n).attr("height",o);const l="translate("+a.left+","+a.top+")",d=i.select(".chart-estadisticas-container");d.attr("transform",l),function(t,a){c.count.x.range([0,t]).padding(.6),c.count.y.range([a,0])}(e,s);const p=r.select(".area-container-chart-vertical").selectAll(".bar-vertical").data(t),u=p.enter().append("rect").attr("class","bar-vertical");p.merge(u).attr("width",c.count.x.bandwidth()).attr("x",t=>c.count.x(t.nombre)).attr("y",t=>c.count.y(0)).attr("height",0).transition().ease(d3.easeSin).duration(1200).attr("y",t=>c.count.y(t.valor)).attr("height",t=>s-c.count.y(t.valor)),function(t){const a=d3.axisBottom(c.count.x);t.select(".axis-x").attr("transform","translate(0,"+s+")").call(a);const e=d3.axisLeft(c.count.y).tickFormat(d3.format("d")).ticks(5).tickSizeInner(-n);t.select(".axis-y").transition().duration(1e3).call(e)}(d)}window.addEventListener("resize",function(){d(l)}),d3.csv(t,function(t,a){t?console.log(t):((l=a).forEach(t=>{t.valor=+t.valor}),function(){const t=i.select(".chart-estadisticas-container");t.append("g").attr("class","axis axis-x"),t.append("g").attr("class","axis axis-y"),t.append("g").attr("class","area-container-chart-vertical")}(),function(){const t=d3.scaleBand().domain(l.map(function(t){return t.nombre})),a=d3.scaleLinear().domain([0,d3.max(l,t=>t.valor)+d3.max(l,t=>t.valor)/4]);c.count={x:t,y:a}}(),d(l))})}var container=document.getElementById("scroll"),step=document.querySelector(".step"),graphic=document.querySelector(".scroll__graphic"),text=document.querySelector(".scroll__text"),scroller=scrollama();function handleResize(){var t=Math.floor(.75*window.innerHeight);step.style.height=t+"px";var a=step.getBoundingClientRect(),e=container.getBoundingClientRect().width,s=(a.width,e.width,e-64),n=Math.floor(window.innerHeight/2);Math.floor(n/2);graphic.style.width=s,graphic.style.height=n,scroller.resize()}function handleStepEnter(t){0===t.index?estadisticasChart(csvElements[0]):1===t.index?estadisticasChart(csvElements[1]):2===t.index?estadisticasChart(csvElements[2]):3===t.index?estadisticasChart(csvElements[3]):4===t.index&&estadisticasChart(csvElements[4])}function init(){handleResize(),scroller.setup({container:"#scroll",graphic:".scroll__graphic",text:".scroll__text",step:".scroll__text .step",offset:.63}).onStepEnter(handleStepEnter),window.addEventListener("resize",handleResize)}function initResponsive(){scroller.setup({step:".step"}).onStepEnter(handleStepEnter)}function multipleLines(){var t=24,a=24,e=24,s=24,n=960-s-a,o=220-t-e;d3.scaleOrdinal(["#9a1622","#e30613","#0080b8","#f07a36"]);let r=d3.timeParse("%x");var i=d3.scaleTime().range([0,n]),c=d3.scaleLinear().range([o,0]),l=d3.area().x(function(t){return i(t.fecha)}).y0(o).y1(function(t){return c(t.votos)}).curve(d3.curveBasis),d=d3.line().x(function(t){return i(t.fecha)}).y(function(t){return c(t.votos)}).curve(d3.curveBasis);d3.csv("datos/ciudadanos/legislatura-ciudadanos-votos-a-favor.csv",function(t){return t.votos=+t.votos,t.fecha=r(t.fecha),t},function(r,p){var u=d3.nest().key(function(t){return t.presentada}).entries(p);u.forEach(function(t){t.maxPrice=d3.max(t.values,function(t){return t.votos})}),i.domain([d3.min(p,t=>t.fecha),d3.max(p,t=>t.fecha)]),c.domain([d3.min(p,t=>t.votos),d3.max(p,t=>t.votos)]);var h=d3.select(".grafica-favor-legislatura").selectAll("svg").data(u).enter().append("svg").attr("viewBox","0 0 "+(n+(s+a))+"  "+(o+(t+e))).append("g").attr("transform","translate("+s+","+t+")");h.append("g").attr("class","axis axis-x"),h.append("g").attr("class","axis axis-y");var v=d3.axisBottom(i).tickFormat(d3.timeFormat("%Y")).ticks(5),f=d3.axisLeft(c).tickFormat(d3.format("d")).ticks(5).tickSizeInner(-n);h.select(".axis-x").attr("transform","translate(0,"+o+")").call(v),h.select(".axis-y").call(f),h.append("path").attr("class","area").attr("class",function(t){return t.key}).style("opacity",.7).attr("d",function(t){return l(t.values)}),h.append("path").attr("class","line").attr("d",function(t){return d(t.values)}).style("stroke","#111"),h.append("text").attr("class","multiple-legend").attr("x",16).attr("y",-10).style("text-anchor","start").text(function(t){return t.key})})}width>769?init():initResponsive(),multipleLines();